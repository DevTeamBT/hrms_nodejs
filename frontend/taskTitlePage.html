<!DOCTYPE html>
<html lang="en">
 
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Admin Dashboard | Korsat X Parmaga</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
   
    <!-- ======= Styles ====== -->
    <link rel="stylesheet" href="./style.css">
</head>
 
<body>
  <div class="login" style="display: flex; justify-content: space-between; align-items: center; position: absolute; top: 10px; right: 10px;">
    <h5 id="fullNameDisplay">fullName</h5>
    <button type="button" id="logoutButton" class="btn btn-dark">Log Out</button>
</div>


<!-- =============== Navigation ================ -->
<div class="container">
    <div class="navigation">
        <ul>
            <li>
                <a href="#">
                    <span class="title">Employee - login</span>
                </a>
            </li>
            <li>
                <a href="./index" class="nav-link px-1 align-middle text-blue">
                    <i class="fs-2 bi bi-house-door"></i> <span class="fs-5 ms-4 d-none d-sm-inline pt-2">Home</span></a>
            </li><li>
                <a href="./mydetails" class="nav-link px-1 align-middle text-blue">
                    <i class="fs-2 bi bi-file-earmark-person"></i> <span class="fs-5 ms-4 d-none d-sm-inline pt-2">My Details</span></a>
            </li>
            <li>
                <a href="./timesheet" class="nav-link px-1 align-middle text-blue">
                    <i class="fs-2 bi bi-clock-history"></i> <span class="fs-5 ms-4 d-none d-sm-inline pt-2">Timesheet</span></a>
            </li>
            <li>
                <a href="./resources" class="nav-link px-1 align-middle text-blue">
                    <i class="fs-2 bi bi-gear-wide-connected"></i> <span class="fs-5 ms-4 d-none d-sm-inline pt-2">Resources</span></a>
            </li>
            <li>
                <a href="#" class="nav-link px-1 align-middle text-blue">
                    <i class="fs-2 bi bi-chat-left-text"></i> <span class="fs-5 ms-4 d-none d-sm-inline pt-2">Forums</span></a>
            </li>
            <li>
                <a href="./organization" class="nav-link px-1 align-middle text-blue">
                    <i class="fs-2 bi bi-diagram-3"></i> <span class="fs-5 ms-4 d-none d-sm-inline pt-2">Organization</span></a>
            </li>

           
        </ul>
    </div>
    <div class="toggle" onclick="toggleNav()">
        <ion-icon name="menu-outline"></ion-icon>
    </div>
    <!-- ========================= Main ==================== -->
    <div class="main">
        <div class="topbar">

        </div>
      
    </nav>
    <div id="dateTimeContainer" style="position: fixed; bottom: 20px; right: 20px; background-color: white; padding: 10px; border: 1px solid black;">
      <!-- Date and time will be displayed here -->
  </div>
 
    <div class="container">
      <h4 class="mb-3 timesheet" id="title" onClick="fetchAndDisplayTasks()"><h1 id="taskTitle" ></h1></h4>
   
        <div class="mb-3 row">
          <label for="description" class="col-sm-4 col-form-label"
            >Description:</label
          >   
          <div class="col-sm-4"><h4 id="description"></h4>
          </div>
      </div>
      <!-- <div id="taskDetailsContainer"></div> -->
      <div class="form">
        <form action="/tasks/:taskTitle" method="post">
          
          </div>
          <div class="mb-3 row">
            <label for="comment" id="comment" class="col-sm-4 col-form-label"
              >Comment:</label
            >
            <div class="mb-3 col-sm-4">
              <textarea
                class="form-control"
                placeholder="comment here"
                name="comment"
              ></textarea>
            </div>
          </div>
          <div>
            <div class="buttons">
              <button type="submit" class="btn btn-primary col-sm-2">
                Save
              </button>
              <button type="button" class="btn btn-secondary col-sm-2">
                Cancel
              </button>
            </div>
          </div>
        </form>
      <!-- </div> -->
    <!-- </div> -->
    <!-- <div class="grid"> -->
      <table class="table">
      <thead>
        <tr>
          <th scope="col">S.No</th>
          <th scope="col">Comments</th>
          <th scope="col">Commented BY</th>
          <th scope="col">Timestamp</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row">1</th>
          <td>Mark</td>
          <td>Otto</td>
          <td>@mdo</td>
        </tr>
       
      </tbody>
    </table>
  </div>
  
  <script>
    var sidebarOpen = true;
    function toggleNav() {
        var sidebar = document.querySelector(".navigation");
        var toggleBtn = document.querySelector(".toggle");
        var mainContent = document.querySelector(".main");
        if (sidebarOpen) {
            sidebar.style.width = "0";
            sidebar.style.padding = "0";
            mainContent.style.left = "0";
            // toggleBtn.textContent = "Show";
        } else {
            sidebar.style.width = "250px";
            sidebar.style.padding = "30px";
            mainContent.style.left = "250px";
            // toggleBtn.textContent = "Hide";

        }
        sidebarOpen = !sidebarOpen;
    }
</script>
    <script>
      var sidebarOpen = true;
      function toggleNav() {
        var sidebar = document.querySelector(".flex-column");
        if (sidebarOpen) {
          sidebar.style.width = "0";
          sidebar.style.padding = "0";
        } else {
          sidebar.style.width = "15%";
          sidebar.style.padding = "30px";
        }
        sidebarOpen = !sidebarOpen;
      }
      //   function logout() {
      //     var lg=document.querySelector(".btn");
      //     if(lg.)
      //   }
      document.getElementById('logoutButton').addEventListener('click', function () {
            logout();
        });
 
        function logout() {
            sessionStorage.clear();
            window.history.replaceState({}, 'login', '/login');
            window.location.href = '/login';
        }
        </script>
    </script>
    <script>
      async function createTask(event) {
      event.preventDefault();
      const form = document.querySelector('form'); // Get the form element
    
      const comments = form.elements['comment'].value;
      
    
      // Extract the values of the selected options
      // const addTeam = Array.from(selectedTeams).map(option => option.value);
    
      const data = {
        comments: comments,
        
      };
      console.log('Data:', data);
    
      try {
        const response = await fetch('http://localhost:4000/tasks/:_id', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });
        console.log('Response:', response);
        console.log('Data:', data);
        if (response.ok) {
          const result = await response.json();
          //var userName = result.user.taskTitle;
                console.log('Task created:', result);
                if (result && result.task && result.task.taskTitle) {
                localStorage.setItem('taskTitle', result.task.taskTitle);
                localStorage.setItem('description', result.task.description);
                localStorage.setItem('comments', result.task.comments);
                // localStorage.setItem('time', result.task.createdAt);
                console.log(result.task.taskTitle);
              } else {
                console.error('Task title is missing in the response:', result);
              }
          alert('comments added successfully!');
          // Redirect to another page after successful task creation
          // window.location.href = 'http://localhost:4000/tasks'; // Change '/another-page.html' to the desired page URL
        } else {
          console.error('Error in comment task:', response.status, response.statusText);
        }
      } catch (error) {
        console.error('Error in comment task:', error);
      }
      
    }
    </script>

  <script>
    const loggedInUserJSON = localStorage.getItem('loggedInUser');
  
  // Parse the JSON string to get the object
  const loggedInUser = JSON.parse(loggedInUserJSON);
  
  // Check if loggedInUser and fullName are present
  if (loggedInUser && loggedInUser.fullName) {
      // If present, update the HTML element with the full name
      document.getElementById('fullNameDisplay').textContent = loggedInUser.fullName;
  } else {
      // If not present, display a default message or handle accordingly
      document.getElementById('fullNameDisplay').textContent = 'Full name not found in localStorage';
  }
  </script>

 <!-- <script>

    async function addComment(taskId) {
        // Retrieve comment text from the input field
        const commentText = document.getElementById('commentInput').value;

        try {
            // Send a POST request to the server to add the comment
            const response = await fetch(`http://localhost:4000/tasks/${taskId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ comments: [{ text: commentText }] })
            });

            // Check if the request was successful
            if (response.ok) {
                const updatedTask = await response.json();
                // Optionally, update the UI with the updated task information
                console.log('Comment added successfully:', updatedTask);
                // Clear the input field after adding the comment
                document.getElementById('commentInput').value = '';
            } else {
                // Handle errors if the request was not successful
                console.error('Failed to add comment:', response.status, response.statusText);
            }
        } catch (error) {
            console.error('Error adding comment:', error);
        }
    }

</script> -->

<!-- taskTitle from localStorage -->
    <script>
      
        // Retrieve the stored task title from localStorage
        const taskTitle = localStorage.getItem('selectedTaskTitle');

        // Check if the task title exists
        if (taskTitle) {
            // If it exists, display it on the page
            document.getElementById('taskTitle').textContent = taskTitle;
        } else {
            // If it doesn't exist, display a default message or handle accordingly
            document.getElementById('taskTitle').textContent = 'Task title not found in localStorage';
        }
    
    </script>
    <script>
       // Retrieve the stored description from localStorage
        const description = localStorage.getItem('selectedDescription');

        // Check if the description exists
        if (description) {
            // If it exists, display it on the page
            document.getElementById('description').textContent = description;
        } else {
            // If it doesn't exist, display a default message or handle accordingly
            document.getElementById('description').textContent = 'Description not found in localStorage';
        }
  </script>
  <script>
    // Retrieve the stored date and time from localStorage
    const dateTimeString = localStorage.getItem('time');

    // Check if the date and time exist
    if (dateTimeString) {
        // Parse the date and time string into a Date object
        const dateTime = new Date(dateTimeString);

        // Extract the date part from the date and time
        const date = dateTime.toISOString().split('T')[0];

        // Display the date on the page
        document.getElementById('dateTimeContainer').textContent = date;
    } else {
        // If the date and time are not found, display a default message
        document.getElementById('dateTimeContainer').textContent = 'Date not found in localStorage';
    }
</script>






  
  </body>
</html>